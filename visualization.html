<!DOCTYPE html>
<html lang="en">

<body style="background-color:#000000">
    <canvas id="myCanvas" width="500" height="500" style="border:1px solid #000000"></canvas>
    <div>
        <input type="radio" id="electron" name="object" value="electron">
        <label for="electron">electron</label>
        <input type="radio" id="proton" name="object" value="proton">
        <label for="proton">proton</label>
    </div>
</body>


<script>
    const fluxScale = 500000;
    var c = document.getElementById("myCanvas");
    const electronImage = new Image();
    electronImage.src = "electron.png";
    const protonImage = new Image();
    protonImage.src = "proton.png";

    var electrons = [
        [75, 75],
    ];
    var protons = [
        [120, 120],
    ];

    const clamp = (num, min, max) => Math.min(Math.max(num, min), max);

    const scale = (number, [inMin, inMax], [outMin, outMax]) => {
        // if you need an integer value use Math.floor or Math.ceil here
        return (number - inMin) / (inMax - inMin) * (outMax - outMin) + outMin;
    }

    function onlyOne(checkbox) {
        var checkboxes = document.getElementsByName('check')
        checkboxes.forEach((item) => {
            if (item !== checkbox) item.checked = false
        })
    }

    function drawSubatoms(ctx) {
        for (var electron in electrons) {
            //console.log(electrons[electron]);
            ctx.drawImage(electronImage, electrons[electron][0] - 25, electrons[electron][1] - 25, 50, 50);
        }
        for (var proton in protons) {
            //console.log(protons[proton]);
            ctx.drawImage(protonImage, protons[proton][0] - 25, protons[proton][1] - 25, 50, 50);
        }
    }

    function drawFlux() {
        if (!c.getContext) {
            alert("html5 is not supported in this web browser!");
            return;
        }
        var ctx = c.getContext("2d");

        var data = new Uint8ClampedArray(500 * 500 * 4);
        for (var y = 0; y < 500; y++) {
            for (var x = 0; x < 500; x++) {
                var fieldVec = [0, 0];

                for (var proton in protons) {
                    const distx = x - protons[proton][0];
                    const disty = y - protons[proton][1];
                    const dist = Math.sqrt(distx * distx + disty * disty);
                    const strength = 1 / (dist * dist);

                    fieldVec[0] += strength * (distx / dist);
                    fieldVec[1] += strength * (disty / dist);
                }

                for (var electron in electrons) {
                    const distx = x - electrons[electron][0];
                    const disty = y - electrons[electron][1];
                    const dist = Math.sqrt(distx * distx + disty * disty);
                    const strength = 1 / (dist * dist);

                    fieldVec[0] -= strength * (distx / dist);
                    fieldVec[1] -= strength * (disty / dist);

                }

                const finalDirection = Math.atan2(fieldVec[1], fieldVec[0]);
                const finalStrength = Math.sqrt(fieldVec[0] * fieldVec[0] + fieldVec[1] * fieldVec[1]);

                data[((x + (y * 500)) * 4) + 0] = scale(fieldVec[0] / finalStrength, [-1, 1], [0, 255]);
                data[((x + (y * 500)) * 4) + 1] = scale(fieldVec[1] / finalStrength, [-1, 1], [0, 255]);
                data[((x + (y * 500)) * 4) + 2] = 255;

                for (var i = 0; i < 3; i++) {
                    data[((x + (y * 500)) * 4) + 3] = finalStrength * fluxScale;
                }

            }
        }

        ctx.putImageData(new ImageData(data, 500), 0, 0);

        drawSubatoms(ctx);
    }

    drawFlux();


    c.addEventListener("click", function (e) {
        var x = e.pageX - c.offsetLeft;
        var y = e.pageY - c.offsetTop;

        electrons[electrons.length] = [x, y];
        drawFlux();
    });

</script>

</html>